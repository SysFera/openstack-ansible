---
- name: Install horizon
  hosts: dashboard
  sudo: True
  gather_facts: True
  tasks:

    - name: ensure packages are installed
      yum: 
        pkg: "{{ item }}" 
        state: latest 
         
        
      with_items: 
        - mod_wsgi
        - memcached 
        - openstack-dashboard 


    - name: ensure services are stopped
      service:
        name: "{{ item }}"
        state: stopped
      with_items:
        - memcached
        - httpd

    - name: update memcached.conf from template
      template:
        src: templates/etc/memcached.conf
        dest: /etc/memcached.conf
        owner: root
        group: root
        mode: 0644

    - name: update local_settings.py from template
      template:
        src: templates/etc/openstack-dashboard/local_settings.py
        dest: /etc/openstack-dashboard/local_settings.py
        owner: root
        group: root
        mode: 0644

    - name: ensure services are started and enabled
      service:
        name: "{{ item }}"
        state: restarted
        enabled: yes
      with_items:
        - memcached
        - httpd
